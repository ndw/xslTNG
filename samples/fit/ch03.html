<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Chapter  3.  Callouts</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="http://purl.org/dc/elements/1.1/" rel="schema.dc"/><meta name="dc.modified" content="2020-08-03T07:27:19Z"/><meta name="dc.created" content="2020-07-18"/><meta name="generator" content="DocBook xslTNG version 1.3.0a1 / 65e8b8b / SAXON EE 10.1"/><link href="./css/docbook.css" rel="stylesheet"/><link href="./css/docbook-screen.css" rel="stylesheet"/><link href="./css/pygments.css" rel="stylesheet"/><link href="./css/docbook-toc.css" rel="stylesheet"/><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=MML_CHTML"></script><link rel="prev" href="ch02.html"/><link rel="next" href="ch04.html"/><link rel="up" href="index.html"/><link rel="home" href="index.html"/></head><body><nav class="top"><div><a href="index.html">Home</a> <a href="index.html">Up</a> <a href="ch04.html">Next</a> <a href="ch02.html">Previous</a></div></nav><main><div id="callouts" class="chapter"><header><h2><span class="label">Chapter<span class="sep"> </span></span><span class="number">3<span class="sep">. </span></span>Callouts</h2></header><p>Callouts are a mechanism for decorating the verbatim content of
<code class="tag tag-element">programlisting</code> elements with marks that can be
cross-referenced in documentation. They have the real advantage that
they can be used to decorate the actual code or other
listing. Importing the actual
listing assures that the documented listing and the actual listing
will be the same.</p><p>A system where you have to import the code or add the markup
inline introduces the risk that the listing being documented will not
be updated when the underlying resource is updated.</p><p>The program below computes the
“<em>n</em>th” Fibonacci number.</p><div class="programlistingco"><div class="pre-wrap highlight" db-startinglinenumber="1" db-numberoflines="9"><pre class="language-python long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code><span class="ch">#!/bin/env python</span></code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code><span class="sd">"""Computes the n'th Fibonacci number."""</span></code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code><span class="kn">import</span> <span class="nn">sys</span></code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code><span class="kn">import</span> <span class="nn">math</span></code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code><span class="kn">import</span> <span class="nn">click</span>  <a id="py.importclick" class="callout-bug linecolumn" href="#py.importclick.co" db-line="7" db-column="15" title="Highlights the click library">①</a></code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code><span class="n">SQRT5</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <a id="py.sqrt5" class="callout-bug linecolumn" href="#py.sqrt5.co" db-line="9" db-column="23" title="Constant: √5">②</a></code></span></span>
</pre></div><div class="calloutlist"><dl><dt id="py.importclick.co" class="callout"><a class="callout-bug" href="#py.importclick">①</a></dt><dd><p><a href="bib01.html#Click" class="xref xref-bibliomixed"><span><span class="xreftitle"><span class="abbrev">Click</span></span></span></a> is my current favorite library for
parsing command line arguments in Python.</p></dd><dt id="py.sqrt5.co" class="callout"><a class="callout-bug" href="#py.sqrt5">②</a></dt><dd><p>This <span id="fibmml" class="phrase">constant<a class="annomark" href="#py.fib.co_annotation1"><sup>⌖</sup><sup class="num">1</sup></a></span> is the 
<span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" display="inline">
<msqrt><mrow><mn>5</mn></mrow></msqrt></math></span>.
</p></dd></dl></div></div><p>I’m also taking advantage of the ability to use
<a href="bib01.html#XInclude" class="xref xref-bibliomixed"><span><span class="xreftitle"><span class="abbrev">XInclude</span></span></span></a> (and <a href="bib01.html#RFC5147" class="xref xref-bibliomixed"><span><span class="xreftitle"><span class="abbrev">RFC 5147</span></span></span></a>)
to break the listing into manageable
fragments for documentation. The listing above, and the one below,
are lines from the same file.</p><div class="programlistingco"><div class="pre-wrap highlight" db-startinglinenumber="11" db-numberoflines="26"><pre class="language-python long numbered programlisting verbatim"><span class="line" db-line="1"><span class="ln">11</span><span class="ld"><code><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span></code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code><span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">"number"</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span></code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>               <a id="py.click" class="callout-bug linecolumn" href="#py.click.co" db-line="3" db-column="16" title="Click takes care of type checking the arguments">③</a> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">IntRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span></code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">number</span><span class="p">):</span></code></span></span>
<span class="line" db-line="5"><span class="ln">15</span><span class="ld"><code>    <span class="sd">"""Calculate the 'number'th Fibonacci number."""</span></code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>    <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"The </span><span class="si">{</span><span class="n">make_ordinal</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="si">}</span><span class="s2"> Fibonacci number is "</span></code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>    <span class="k">try</span><span class="p">:</span></code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>        <span class="n">value</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">SQRT5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="n">number</span> <span class="o">-</span></code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>                 <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">SQRT5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="n">number</span><span class="p">)</span> <span class="o">/</span> <span class="n">SQRT5</span>      <a id="py.fib" class="callout-bug linecolumn" href="#py.fib.co" db-line="9" db-column="60" title="Closed-form calculation of n’th Fibonacci number">④</a></code></span></span>
<span class="line" db-line="10"><span class="ln">20</span><span class="ld"><code>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span></code></span></span>
<span class="line" db-line="11"><span class="ln"></span><span class="ld"><code>    <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span></code></span></span>
<span class="line" db-line="12"><span class="ln"></span><span class="ld"><code>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">too large to calculate."</span><span class="p">)</span></code></span></span>
<span class="line" db-line="13"><span class="ln"></span><span class="ld"><code>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code></span></span>
<span class="line" db-line="14"><span class="ln"></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="15"><span class="ln">25</span><span class="ld"><code> </code></span></span>
<span class="line" db-line="16"><span class="ln"></span><span class="ld"><code><span class="k">def</span> <span class="nf">make_ordinal</span><span class="p">(</span><span class="n">n</span><span class="p">):</span></code></span></span>
<span class="line" db-line="17"><span class="ln"></span><span class="ld"><code>    <span class="sd">"""Create an ordinal from a number."""</span></code></span></span>
<span class="line highlight line18" db-line="18"><span class="ln"></span><span class="ld"><code>    <span class="c1"># https://stackoverflow.com/questions/9647202</span>          <span id="py.ordinal" href="#py.ordinal.co" db-line="18" db-column="60" title="Stackoverflow answer to the question “how do I make an&#xA;    ordinal number in Python”?" class="callout-bug linerange firstline">⑤</span></code></span></span>
<span class="line" db-line="19"><span class="ln"></span><span class="ld"><code>    <span class="n">suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"th"</span><span class="p">,</span> <span class="s2">"st"</span><span class="p">,</span> <span class="s2">"nd"</span><span class="p">,</span> <span class="s2">"rd"</span><span class="p">,</span> <span class="s2">"th"</span><span class="p">][</span><span class="nb">min</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span></code></span></span>
<span class="line" db-line="20"><span class="ln">30</span><span class="ld"><code>    <span class="k">if</span> <span class="mi">11</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">:</span></code></span></span>
<span class="line" db-line="21"><span class="ln"></span><span class="ld"><code>        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">"th"</span></code></span></span>
<span class="line" db-line="22"><span class="ln"></span><span class="ld"><code>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">suffix</span></code></span></span>
<span class="line" db-line="23"><span class="ln"></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="24"><span class="ln"></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="25"><span class="ln">35</span><span class="ld"><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span></code></span></span>
<span class="line" db-line="26"><span class="ln"></span><span class="ld"><code>    <span class="n">fibonacci</span><span class="p">()</span>  <a id="py.main" class="callout-bug linecolumn" href="#py.main.co" db-line="26" db-column="18" title="If this is a main program, run it!">⑥</a></code></span></span>
</pre></div><div class="calloutlist"><dl><dt id="py.click.co" class="callout"><a class="callout-bug" href="#py.click">③</a></dt><dd><p>One of the real strengths of using a tool like Click to wrangle
arguments is that you get type and range checking pretty much for free.</p></dd><dt id="py.fib.co" class="callout"><a class="callout-bug" href="#py.fib">④</a></dt><dd><p>This is the closed-form solution to finding the
“<em>n</em>th” Fibonacci number:</p><div id="py.fib.co_informalequation1" class="informalequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" class="equation" display="block">
<mfrac>
  <mrow><mn>1</mn></mrow>
  <mrow><msqrt><mrow><mn>5</mn></mrow></msqrt></mrow></mfrac> <mfenced separators="" open="(" close=")"><mrow><msup><mrow><mfenced separators="" open="(" close=")"><mrow><mfrac><mrow><mn>1</mn> <mo class="MathClass-bin">+</mo> <msqrt><mrow><mn>5</mn></mrow></msqrt></mrow>
  <mrow><mn>2</mn></mrow></mfrac>    </mrow></mfenced></mrow><mrow><mi>n</mi></mrow></msup> <mo class="MathClass-bin">-</mo><msup><mrow><mfenced separators="" open="(" close=")"><mrow><mfrac><mrow><mn>1</mn> <mo class="MathClass-bin">-</mo><msqrt><mrow><mn>5</mn></mrow></msqrt></mrow>
  <mrow><mn>2</mn></mrow></mfrac></mrow></mfenced></mrow>
  <mrow><mi>n</mi></mrow></msup></mrow></mfenced>
</math></div><p>The closed-form solution amuses me because I used calculating Fibonacci
numbers
(recursively) as an argument for greater expressive power in XSLT 1.0.
“What if I wanted to number a list with the Fibonacci numbers?”
</p></dd><dt id="py.ordinal.co" class="callout"><a class="callout-bug" href="#py.ordinal">⑤</a></dt><dd><p>Stackoverflow showed me how to print the number as an ordinal.</p></dd><dt id="py.main.co" class="callout"><a class="callout-bug" href="#py.main">⑥</a></dt><dd><p>Finally, if this is a main program, compute the answer.</p></dd></dl></div></div><p>If you hover over the callout numbers in the listing,
alt-text will be displayed.</p></div></main><footer><div class="annotations"><div class="annotation-wrapper title">Annotations</div><div id="py.fib.co_annotation1" class="annotation-wrapper"><div class="annotation-body"><div class="annotation-header"><div class="annotation-close"></div><div class="annotation-title"><span class="annomark"><sup>⌖</sup><sup class="num">1</sup> </span></div></div><div class="annotation-content">
<p>If you use <a href="#MathML" class="xref xref-bibliomixed"><span><span class="xreftitle"><span class="abbrev">MathML</span></span></span></a>, the stylesheets automatically include the
<a href="#MathJax" class="xref xref-bibliomixed"><span><span class="xreftitle"><span class="abbrev">MathJax</span></span></span></a> libraries (or the MathML rendering libraries of
your choosing). This allows you to display complex equations, of course, but it
can also improve the appearance of even simple expressions, such as
√5.</p>
<p>(This is an annotation, more about them in
the next chapter.)</p>
</div></div></div></div></footer><nav class="bottom"><table width="100%"><tr><td class="previous"><a href="ch02.html">Previous</a></td><td class="up"><a href="index.html">Up</a></td><td class="next"><a href="ch04.html">Next</a></td></tr><tr><td class="previous"><span class="label">Chapter<span class="sep"> </span></span><span class="number">2<span class="sep">. </span></span>Persistent Table of Contents</td><td class="up"><a href="index.html">Home</a></td><td class="next"><span class="label">Chapter<span class="sep"> </span></span><span class="number">4<span class="sep">. </span></span>Annotations</td></tr></table><nav class="tocopen"></nav><nav class="toc"></nav><!-- Hide ToC details from user agents that don’t support JS --><script type="text/html" class="tocopen"><span>[toc]</span></script><script type="text/html" class="toc"><header><span>Table of Contents</span><span class="close"><span>╳</span></span></header><div><ul class="toc"><li><a href="ch01.html"><span class="label">Chapter<span class="sep"> </span></span><span class="number">1<span class="sep">. </span></span>Clean Look and Feel</a></li><li><a href="ch02.html"><span class="label">Chapter<span class="sep"> </span></span><span class="number">2<span class="sep">. </span></span>Persistent ToC</a></li><li><a href="ch03.html"><span class="label">Chapter<span class="sep"> </span></span><span class="number">3<span class="sep">. </span></span>Callouts</a></li><li><a href="ch04.html"><span class="label">Chapter<span class="sep"> </span></span><span class="number">4<span class="sep">. </span></span>Annotations</a></li><li><a href="ch05.html"><span class="label">Chapter<span class="sep"> </span></span><span class="number">5<span class="sep">. </span></span>Extended Links</a></li><li><a href="appa.html"><span class="label">Appendix<span class="sep"> </span></span><span class="number">A<span class="sep">. </span></span>Paged media support</a></li><li><a href="bib01.html">References</a></li></ul></div></script></nav><script type="text/html" class="annotation-close"><span>╳</span></script><script src="./js/annotations.js"></script><script src="./js/xlink.js"></script><script src="./js/persistent-toc.js"></script><script src="./js/chunk-nav.js"></script></body></html>